<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>JOE OS | æè‡´èšåˆ</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        :root {
            --primary: #a29bfe;
            --bg: #f5f7fa;
            --glass: rgba(255, 255, 255, 0.7);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        body {
            margin: 0;
            background: var(--bg);
            color: #2d3436;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow-x: hidden;
        }

        /* --- 1. é¡¶éƒ¨ Deco é£æ ¼å¯¼èˆª --- */
        .joe-header {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 1100px;
            height: 60px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: flex;
            align-items: center;
            padding: 0 25px;
            box-shadow: var(--shadow);
            z-index: 9999;
        }

        .joe-logo {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-right: 30px;
        }

        .joe-nav { display: flex; gap: 12px; flex: 1; align-items: center; }
        
        /* 1:1 è¿˜åŸå½©è‰²è¯ä¸¸æ ‡ç­¾ */
        .joe-btn {
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            display: flex;
            align-items: center;
            gap: 5px;
            color: #636e72;
        }

        .btn-home { background: #eee; }
        .btn-search { background: #edf2ff; color: #4c6ef5; }
        .btn-movie { background: #fff5f5; color: #ff6b6b; }
        .btn-tv { background: #f3f0ff; color: #845ef7; }
        .btn-anime { background: #e6fcf5; color: #0ca678; }
        .btn-variety { background: #fff9db; color: #f59f00; }
        .btn-live { background: #fff0f6; color: #d6336c; }

        .joe-btn:hover { transform: translateY(-2px); filter: brightness(0.95); }
        .joe-btn.active { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: scale(1.05); }

        /* --- 2. ä¸»é¡µé¢å¸ƒå±€ --- */
        .container {
            width: 95%;
            max-width: 1100px;
            margin: 120px auto 50px;
        }

        .brand-title {
            text-align: center;
            margin-bottom: 60px;
        }
        .brand-title h1 { font-size: 72px; margin: 0; font-weight: 900; color: #2d3436; opacity: 0.9; }
        .brand-title p { color: #b2bec3; letter-spacing: 4px; font-weight: 500; }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 20px;
            font-weight: 700;
            font-size: 20px;
        }

        /* --- 3. æµ·æŠ¥å¡ç‰‡ (Deco é£æ ¼) --- */
        .joe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 25px;
        }

        .joe-card {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            cursor: pointer;
            transition: 0.4s ease;
            position: relative;
        }

        .joe-card:hover { transform: translateY(-10px); box-shadow: 0 12px 30px rgba(0,0,0,0.1); }

        .joe-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }

        .joe-card .tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            color: #fff;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 6px;
        }

        .joe-card .info { padding: 12px; }
        .joe-card .name { font-size: 14px; font-weight: 700; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .joe-card .meta { font-size: 11px; color: var(--primary); font-weight: 600; }

        /* --- 4. ç®¡ç†é¢æ¿ (æˆªå›¾3è¿˜åŸ) --- */
        .modal-mask {
            position: fixed; inset: 0; background: rgba(0,0,0,0.4);
            display: none; align-items: center; justify-content: center; z-index: 10000;
            backdrop-filter: blur(5px);
        }
        .joe-modal {
            background: #fff;
            width: 90%;
            max-width: 600px;
            border-radius: 24px;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .admin-item {
            background: #f8fafc;
            padding: 18px 25px;
            border-radius: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border: 1px solid #f1f5f9;
        }
        .admin-item:hover { background: #fff; border-color: var(--primary); color: var(--primary); }

        /* --- æ’­æ”¾å™¨å…¨å± --- */
        #player-layer {
            position: fixed; inset: 0; background: #000; z-index: 20000; display: none;
        }
    </style>
</head>
<body>

<header class="joe-header">
    <div class="joe-logo">JOE OS</div>
    <div class="joe-nav">
        <button class="joe-btn btn-home active" onclick="location.reload()">é¦–é¡µ</button>
        <button class="joe-btn btn-search" onclick="showSearch()">æœç´¢</button>
        <button class="joe-btn btn-movie" onclick="fetchDouban('Movie')">ç”µå½±</button>
        <button class="joe-btn btn-tv" onclick="fetchDouban('TV')">å‰§é›†</button>
        <button class="joe-btn btn-anime" onclick="fetchDouban('Anime')">åŠ¨æ¼«</button>
        <button class="joe-btn btn-variety" onclick="fetchDouban('Variety')">ç»¼è‰º</button>
        <button class="joe-btn btn-live">ç›´æ’­</button>
    </div>
    <div style="display:flex; gap:15px; align-items:center;">
        <span style="cursor:pointer" onclick="openAdmin()">âš™ï¸</span>
        <div style="width:35px; height:35px; border-radius:50%; background:linear-gradient(45deg, #a29bfe, #6c5ce7);"></div>
    </div>
</header>

<div class="container">
    <div class="brand-title">
        <h1>JOE</h1>
        <p>å‘ç° Â· æ”¶è— Â· ç»§ç»­è§‚çœ‹</p>
    </div>

    <div id="history-section" style="display:none;">
        <div class="section-header">
            <span>ç»§ç»­è§‚çœ‹</span>
            <span style="color:#b2bec3; font-size:12px; cursor:pointer" onclick="clearHis()">æ¸…ç©ºè®°å½•</span>
        </div>
        <div class="joe-grid" id="history-grid"></div>
    </div>

    <div class="section-header">
        <span id="list-title">ä»Šæ—¥çƒ­é—¨æ¨è</span>
        <span style="color:var(--primary); font-size:12px; cursor:pointer">æŸ¥çœ‹æ›´å¤š ></span>
    </div>
    <div class="joe-grid" id="main-grid"></div>
</div>

<div class="modal-mask" id="admin-modal" onclick="closeAdmin(event)">
    <div class="joe-modal" onclick="event.stopPropagation()">
        <h2 style="margin-top:0;">ç®¡ç†å‘˜è®¾ç½® <span style="background:#ff7675; color:#fff; font-size:10px; padding:2px 6px; border-radius:4px; vertical-align:middle;">é›†ç¾¤ç®¡ç†</span></h2>
        <div class="admin-item"><span>ğŸ“„ é…ç½®æ–‡ä»¶</span><span>&gt;</span></div>
        <div class="admin-item"><span>âš™ï¸ ç«™ç‚¹é…ç½®</span><span>&gt;</span></div>
        <div class="admin-item" onclick="addApi()"><span>ğŸ“º è§†é¢‘æºé…ç½® (æ·»åŠ æ¥å£)</span><span style="font-size:20px;">+</span></div>
        <div class="admin-item"><span>ğŸ“¡ ç›´æ’­æºé…ç½®</span><span>&gt;</span></div>
        <div class="admin-item"><span>ğŸ“¦ TVBoxé…ç½®</span><span>&gt;</span></div>
        <div class="admin-item"><span>ğŸ“ åˆ†ç±»é…ç½®</span><span>&gt;</span></div>
        <div class="admin-item" onclick="toggleProxy()"><span>ğŸŒ è±†ç“£ä»£ç†è®¾ç½®</span><span id="proxy-status">å·²å¯ç”¨</span></div>
        <button onclick="closeAdmin(null)" style="width:100%; padding:15px; background:#f1f2f6; border:none; border-radius:15px; margin-top:10px; cursor:pointer;">é€€å‡ºç®¡ç†é¢æ¿</button>
    </div>
</div>

<div id="player-layer">
    <div onclick="closePlayer()" style="position:absolute; top:30px; left:30px; z-index:20001; color:#fff; background:rgba(255,255,255,0.2); padding:10px 25px; border-radius:30px; cursor:pointer; backdrop-filter:blur(10px);">è¿”å›ä¸»é¡µ</div>
    <video id="v-core" class="video-js vjs-big-play-centered" controls style="width:100%; height:100%;"></video>
</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
    let apis = JSON.parse(localStorage.getItem('joe_apis') || '[]');
    let history = JSON.parse(localStorage.getItem('joe_history') || '[]');
    const player = videojs('v-core');

    window.onload = () => {
        renderHistory();
        fetchDouban('Movie');
    };

    // è±†ç“£æ•°æ®å¯¼å…¥é€»è¾‘
    async function fetchDouban(type) {
        document.getElementById('list-title').innerText = `è±†ç“£çƒ­æœ Â· ${type}`;
        const grid = document.getElementById('main-grid');
        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center;">æ­£åœ¨åŒæ­¥è±†ç“£äº‘æ•°æ®...</div>';

        try {
            // ä½¿ç”¨æˆªå›¾2ä¸­æåˆ°çš„è±†ç“£ä»£ç†é€»è¾‘ (æ¨¡æ‹Ÿ)
            const res = await fetch(`https://api.wmdb.tv/api/v1/top?type=${type}&skip=0&limit=18`);
            const data = await res.json();
            grid.innerHTML = '';
            data.forEach(m => {
                const card = document.createElement('div');
                card.className = 'joe-card';
                card.innerHTML = `
                    <div class="tag">${m.doubanRating || 'TOP'}</div>
                    <img src="${m.data[0].poster}" referrerpolicy="no-referrer">
                    <div class="info">
                        <div class="name">${m.data[0].name}</div>
                        <div class="meta">è¯„åˆ†: ${m.doubanRating || 'æš‚æ— '}</div>
                    </div>
                `;
                card.onclick = () => autoMatch(m.data[0].name);
                grid.appendChild(card);
            });
        } catch (e) { grid.innerHTML = 'è±†ç“£ä»£ç†å“åº”è¶…æ—¶ï¼Œè¯·åœ¨åå°æ›´æ¢ä»£ç†ã€‚'; }
    }

    // è‡ªåŠ¨åŒ¹é…æ’­æ”¾æº
    async function autoMatch(name) {
        if(apis.length === 0) { alert('è¯·å…ˆåœ¨ç®¡ç†é¢æ¿æ·»åŠ è§†é¢‘æºæ¥å£ï¼'); openAdmin(); return; }
        
        for(let api of apis) {
            try {
                const res = await fetch(`${api.url}?ac=detail&wd=${encodeURIComponent(name)}`).then(r => r.json());
                if(res.list && res.list.length > 0) {
                    playVideo(res.list[0]);
                    return;
                }
            } catch(e) {}
        }
        alert('è¯¥ç‰‡åœ¨å½“å‰æ‰€æœ‰æ¥å£ä¸­æœªæ‰¾åˆ°ï¼Œè¯·åœ¨æœç´¢é¡µæ‰‹åŠ¨å°è¯•ã€‚');
    }

    function playVideo(video) {
        const url = video.vod_play_url.split('$')[1].split('#')[0];
        document.getElementById('player-layer').style.display = 'block';
        player.src({ src: url, type: 'application/x-mpegURL' });
        player.play();
        
        // è®°å½•å†å²
        history = history.filter(v => v.vod_id !== video.vod_id);
        history.unshift(video);
        localStorage.setItem('joe_history', JSON.stringify(history.slice(0, 10)));
        renderHistory();
    }

    function renderHistory() {
        const section = document.getElementById('history-section');
        const grid = document.getElementById('history-grid');
        if(history.length === 0) { section.style.display = 'none'; return; }
        section.style.display = 'block';
        grid.innerHTML = '';
        history.forEach(v => {
            const card = document.createElement('div');
            card.className = 'joe-card';
            card.innerHTML = `<img src="${v.vod_pic}"><div class="info"><div class="name">${v.vod_name}</div><div class="meta">ç»§ç»­è§‚çœ‹</div></div>`;
            card.onclick = () => playVideo(v);
            grid.appendChild(card);
        });
    }

    // åå°ç®¡ç†é€»è¾‘
    function openAdmin() { document.getElementById('admin-modal').style.display = 'flex'; }
    function closeAdmin(e) { if(!e || e.target === document.getElementById('admin-modal')) document.getElementById('admin-modal').style.display = 'none'; }
    function addApi() {
        const url = prompt('è¯·è¾“å…¥é‡‡é›†ç«™ API æ¥å£åœ°å€ (éœ€æ”¯æŒ JSON):');
        if(url) {
            apis.push({url});
            localStorage.setItem('joe_apis', JSON.stringify(apis));
            alert('æ·»åŠ æˆåŠŸï¼');
        }
    }
    function closePlayer() { player.pause(); document.getElementById('player-layer').style.display = 'none'; }
</script>
</body>
</html>
